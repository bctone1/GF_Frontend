<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 실습 - GrowFit</title>

    <style>
        /* ========== CSS Variables ========== */
        :root {
            --primary-50: #faf5ff;
            --primary-100: #f3e8ff;
            --primary-200: #e9d5ff;
            --primary-300: #d8b4fe;
            --primary-400: #c084fc;
            --primary-500: #a855f7;
            --primary-600: #9333ea;
            --primary-700: #7e22ce;
            --primary-800: #6b21a8;
            --primary-900: #581c87;

            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;

            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;

            --background: #ffffff;
            --surface: #f8fafc;
            --border: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;

            --gpt-color: #10a37f;
            --gpt-bg: #ecfdf5;
            --claude-color: #d97757;
            --claude-bg: #fff7ed;
            --gemini-color: #4285f4;
            --gemini-bg: #eff6ff;
            --exaone-color: #a50034;
            --exaone-bg: #fdf2f8;

            --sidebar-width: 260px;
            --header-height: 56px;
            --font-sans: -apple-system, BlinkMacSystemFont, "Pretendard", "Segoe UI", sans-serif;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--background);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            flex-shrink: 0;
        }

        .icon--sm {
            width: 16px;
            height: 16px;
        }

        .icon--lg {
            width: 24px;
            height: 24px;
        }

        .app {
            display: flex;
            height: 100vh;
        }

        /* ========== Sidebar ========== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--background);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar__header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar__logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .sidebar__logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .sidebar__logo-text {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .sidebar__logo-badge {
            background: var(--primary-600);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }

        /* Class Selector */
        .class-selector {
            margin-bottom: 16px;
            position: relative;
        }

        .class-selector__button {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: linear-gradient(135deg, var(--primary-50), var(--primary-100));
            border: 1px solid var(--primary-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .class-selector__button:hover {
            border-color: var(--primary-300);
            background: linear-gradient(135deg, var(--primary-100), var(--primary-200));
        }

        .class-selector__icon {
            width: 36px;
            height: 36px;
            background: var(--primary-600);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .class-selector__info {
            flex: 1;
            min-width: 0;
        }

        .class-selector__name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .class-selector__meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 3px;
        }

        .class-selector__status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .class-selector__status--active {
            color: var(--success);
        }

        .class-selector__status-dot {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: currentColor;
        }

        .class-selector__dday {
            font-size: 11px;
            font-weight: 600;
            color: var(--primary-600);
            background: var(--primary-100);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }

        .class-selector__arrow {
            color: var(--text-tertiary);
            transition: transform 0.2s;
        }

        .class-selector__button.open .class-selector__arrow {
            transform: rotate(180deg);
        }

        .class-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s;
            max-height: 300px;
            overflow-y: auto;
        }

        .class-dropdown--open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .class-dropdown__section {
            padding: 8px;
        }

        .class-dropdown__section-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 10px 6px;
        }

        .class-dropdown__item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background 0.2s;
        }

        .class-dropdown__item:hover {
            background: var(--surface);
        }

        .class-dropdown__item--active {
            background: var(--primary-50);
        }

        .class-dropdown__item--disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .class-dropdown__item-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .class-dropdown__item-icon--active {
            background: var(--primary-100);
            color: var(--primary-600);
        }

        .class-dropdown__item-icon--ended {
            background: var(--gray-100);
            color: var(--gray-400);
        }

        .class-dropdown__item-info {
            flex: 1;
            min-width: 0;
        }

        .class-dropdown__item-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .class-dropdown__item-period {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .class-dropdown__item-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: var(--radius-full);
        }

        .class-dropdown__item-badge--active {
            background: var(--success);
            color: white;
        }

        .class-dropdown__item-badge--ended {
            background: var(--gray-200);
            color: var(--text-tertiary);
        }

        .class-dropdown__divider {
            height: 1px;
            background: var(--border);
            margin: 4px 8px;
        }

        .sidebar__new-chat {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 10px;
            border: 1px dashed var(--border);
            border-radius: var(--radius-md);
            background: transparent;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .sidebar__new-chat:hover {
            background: var(--surface);
            border-color: var(--primary-300);
            color: var(--primary-600);
        }

        .sidebar__nav {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar__nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 2px;
        }

        .sidebar__nav-item:hover {
            background: var(--surface);
            color: var(--text-primary);
        }

        .sidebar__nav-item--active {
            background: var(--primary-50);
            color: var(--primary-600);
        }

        .sidebar__nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar__nav-item--class-only {
            display: none;
        }

        .sidebar__nav-item--class-only.visible {
            display: flex;
        }

        .sidebar__section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 16px 16px 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar__section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px 8px;
        }

        .sidebar__section-header .sidebar__section-title {
            padding: 0;
        }

        .sidebar__section-actions {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sidebar__section-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .sidebar__section-btn:hover {
            background: var(--gray-100);
            color: var(--primary-600);
        }

        .sidebar__history {
            flex: 1;
            overflow-y: auto;
            padding: 0 8px;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 2px;
            position: relative;
        }

        .chat-item:hover {
            background: var(--surface);
        }

        .chat-item--active {
            background: var(--primary-50);
        }

        .chat-item__icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-tertiary);
            flex-shrink: 0;
        }

        .chat-item--active .chat-item__icon {
            background: var(--primary-100);
            color: var(--primary-600);
        }

        .chat-item__info {
            flex: 1;
            min-width: 0;
        }

        .chat-item__title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item__time {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .chat-item__menu {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-tertiary);
            opacity: 0;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-item:hover .chat-item__menu {
            opacity: 1;
        }

        .chat-item__menu:hover {
            background: var(--gray-200);
            color: var(--text-primary);
        }

        .sidebar__footer {
            border-top: 1px solid var(--border);
            padding: 8px;
        }

        .sidebar__footer-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .sidebar__footer-item:hover {
            background: var(--surface);
            color: var(--text-primary);
        }

        .sidebar__user {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .sidebar__user:hover {
            background: var(--surface);
        }

        .sidebar__user-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary-400), var(--primary-600));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
        }

        .sidebar__user-name {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .sidebar__user-logout {
            color: var(--text-tertiary);
            transition: color 0.2s;
        }

        .sidebar__user-logout:hover {
            color: var(--error);
        }

        /* ========== Main ========== */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            background: var(--surface);
        }

        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: var(--background);
            border-bottom: 1px solid var(--border);
            gap: 16px;
        }

        .chat-header__left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .chat-header__title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            outline: none;
            border-radius: var(--radius-sm);
            padding: 2px 6px;
            margin: -2px -6px;
        }

        .chat-header__title:focus {
            background: var(--gray-100);
        }

        .chat-header__edit {
            color: var(--text-tertiary);
            cursor: pointer;
            transition: color 0.2s;
        }

        .chat-header__edit:hover {
            color: var(--primary-600);
        }

        .chat-header__right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Mode Indicator - 자동 전환 표시 */
        .mode-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
        }

        .mode-indicator__dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
        }

        .mode-indicator--single .mode-indicator__dot {
            background: var(--success);
        }

        .mode-indicator--compare .mode-indicator__dot {
            background: var(--primary-500);
        }

        .mode-indicator__text {
            color: var(--text-secondary);
        }

        .chat-header__participants {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .participant-avatar {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-left: -8px;
            border: 2px solid var(--background);
            transition: transform 0.2s;
        }

        .participant-avatar:first-child {
            margin-left: 0;
        }

        .participant-avatar:hover {
            transform: scale(1.1);
            z-index: 1;
        }

        .participant-avatar--gpt {
            background: var(--gpt-color);
        }

        .participant-avatar--claude {
            background: var(--claude-color);
        }

        .participant-avatar--gemini {
            background: var(--gemini-color);
        }

        .participant-avatar--exaone {
            background: var(--exaone-color);
        }

        .chat-header__btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border);
            background: var(--background);
            border-radius: var(--radius-md);
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chat-header__btn:hover {
            background: var(--surface);
            border-color: var(--primary-300);
            color: var(--primary-600);
        }

        .chat-header__btn--active {
            background: var(--primary-50);
            border-color: var(--primary-400);
            color: var(--primary-600);
        }

        /* ========== Chat Area ========== */
        .chat-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: visible;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .chat-area--compare {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            padding: 20px;
        }

        .messages {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
        }

        .message--user {
            flex-direction: row-reverse;
        }

        .message__avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }

        .message__avatar--user {
            background: linear-gradient(135deg, var(--primary-400), var(--primary-600));
        }

        .message__avatar--ai {
            background: var(--gray-200);
            color: var(--text-secondary);
        }

        .message__avatar--gpt {
            background: var(--gpt-color);
        }

        .message__avatar--claude {
            background: var(--claude-color);
        }

        .message__avatar--gemini {
            background: var(--gemini-color);
        }

        .message__avatar--exaone {
            background: var(--exaone-color);
        }

        .message__content {
            max-width: 70%;
            display: flex;
            flex-direction: column;
        }

        .message--user .message__content {
            align-items: flex-end;
        }

        .message__bubble {
            padding: 12px 16px;
            border-radius: var(--radius-lg);
            font-size: 14px;
            line-height: 1.6;
        }

        .message__bubble--ai {
            background: var(--background);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .message__bubble--user {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
        }

        .message__actions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .message__action {
            width: 28px;
            height: 28px;
            border: 1px solid var(--border);
            background: var(--background);
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .message__action:hover {
            background: var(--surface);
            color: var(--primary-600);
            border-color: var(--primary-200);
        }

        .message__action--active {
            background: var(--primary-50);
            color: var(--primary-600);
            border-color: var(--primary-300);
        }

        .message__disclaimer {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 8px;
        }

        /* Compare Mode */
        .compare-panel {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            display: flex;
            flex-direction: column;
            min-height: 400px;
        }

        .compare-panel__header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .compare-panel__model {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .compare-panel__model--gpt {
            background: var(--gpt-color);
        }

        .compare-panel__model--claude {
            background: var(--claude-color);
        }

        .compare-panel__model--gemini {
            background: var(--gemini-color);
        }

        .compare-panel__model--exaone {
            background: var(--exaone-color);
        }

        .compare-panel__name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .compare-panel__body {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
        }

        .compare-panel__messages {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .compare-panel__response {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .compare-panel__footer {
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .compare-panel__stats {
            display: flex;
            gap: 16px;
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .compare-panel__stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .compare-panel__actions {
            display: flex;
            gap: 4px;
        }

        /* 비교 패널 내부 채팅 스타일 (작은 크기) */
        .message--compact {
            gap: 8px;
        }

        .message--compact .message__avatar--sm {
            width: 28px;
            height: 28px;
            font-size: 11px;
        }

        .message--compact .message__bubble {
            font-size: 13px;
            padding: 10px 14px;
        }

        .message--compact .message__actions {
            gap: 2px;
            margin-top: 6px;
        }

        .message--compact .message__action {
            width: 24px;
            height: 24px;
        }

        .message--compact .message__meta {
            font-size: 10px;
            margin-top: 4px;
        }

        .compare-prompt {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 16px 20px;
            margin-bottom: 16px;
        }

        .compare-prompt__label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .compare-prompt__text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        /* 비교 응답 카드 (통합 채팅 영역용) */
        .message__compare-responses {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            width: 100%;
        }

        .message__compare-responses .message {
            max-width: 100%;
            flex: 1;
        }

        .message__compare-responses .message__content {
            max-width: 100%;
        }

        .message__model-name {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .message__meta {
            display: flex;
            gap: 12px;
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 6px;
        }

        /* ========== Input Area ========== */
        .input-area {
            background: var(--background);
            border-top: 1px solid var(--border);
            padding: 16px 20px 20px;
            overflow: visible;
        }

        .input-container {
            max-width: 800px;
            margin: 0 auto;
            overflow: visible;
        }

        .input-box__footer {
            overflow: visible;
        }

        .input-box__left,
        .input-box__right {
            overflow: visible;
        }

        .input-preview {
            display: none;
            align-items: center;
            gap: 8px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            padding: 12px 16px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .input-preview--visible {
            display: flex;
        }

        .input-preview__icon {
            color: var(--primary-500);
        }

        .input-preview__text {
            flex: 1;
        }

        .input-preview__close {
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            cursor: pointer;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-preview__close:hover {
            background: var(--gray-200);
            color: var(--text-primary);
        }

        .input-box {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: visible;
            transition: all 0.2s;
        }

        .input-box:focus-within {
            border-color: var(--primary-400);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        .input-preview--visible+.input-box {
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        .input-box__textarea {
            width: 100%;
            min-height: 44px;
            max-height: 160px;
            padding: 12px 16px;
            border: none;
            outline: none;
            resize: none;
            font-size: 14px;
            font-family: var(--font-sans);
            line-height: 1.5;
            color: var(--text-primary);
        }

        .input-box__textarea::placeholder {
            color: var(--text-tertiary);
        }

        .input-box__footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border-top: 1px solid var(--border);
            background: var(--gray-50);
            overflow: visible;
            position: relative;
        }

        .input-box__left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-box__right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border);
            background: var(--background);
            border-radius: var(--radius-md);
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
        }

        .input-btn:hover {
            background: var(--surface);
            border-color: var(--primary-300);
            color: var(--primary-600);
        }

        .input-btn--primary {
            background: var(--primary-600);
            border-color: var(--primary-600);
            color: white;
        }

        .input-btn--primary:hover {
            background: var(--primary-700);
            border-color: var(--primary-700);
        }

        .input-btn--primary:disabled {
            background: var(--gray-300);
            border-color: var(--gray-300);
            cursor: not-allowed;
        }

        .input-btn--active {
            background: var(--primary-50);
            border-color: var(--primary-400);
            color: var(--primary-600);
        }

        .input-btn--recording {
            background: var(--error);
            border-color: var(--error);
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .input-btn__badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 16px;
            height: 16px;
            background: var(--primary-600);
            color: white;
            font-size: 10px;
            font-weight: 600;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        /* Model Multi-Select (기존 칩 스타일 - 유지) */
        .model-multi-select {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
        }

        .model-chip {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--surface);
            border: 1px solid transparent;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .model-chip:hover {
            background: var(--gray-200);
        }

        .model-chip--selected {
            background: var(--primary-50);
            border-color: var(--primary-300);
            color: var(--primary-700);
        }

        .model-chip__dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
        }

        .model-chip__dot--gpt {
            background: var(--gpt-color);
        }

        .model-chip__dot--claude {
            background: var(--claude-color);
        }

        .model-chip__dot--gemini {
            background: var(--gemini-color);
        }

        .model-chip__dot--exaone {
            background: var(--exaone-color);
        }

        .model-chip__check {
            width: 14px;
            height: 14px;
            color: var(--primary-600);
            display: none;
        }

        .model-chip--selected .model-chip__check {
            display: block;
        }

        /* Model Listbox (새 드롭다운 스타일) */
        .model-listbox {
            position: relative;
        }

        .model-listbox__trigger {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            min-width: 180px;
        }

        .model-listbox__trigger:hover {
            border-color: var(--primary-300);
            background: var(--gray-50);
        }

        .model-listbox__trigger.open {
            border-color: var(--primary-400);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        .model-listbox__label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .model-listbox__selected {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .model-listbox__count {
            font-size: 11px;
            font-weight: 500;
            color: var(--primary-600);
            background: var(--primary-50);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
        }

        .model-listbox__arrow {
            color: var(--text-tertiary);
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .model-listbox__trigger.open .model-listbox__arrow {
            transform: rotate(180deg);
        }

        .model-listbox__dropdown {
            position: absolute;
            bottom: calc(100% + 8px);
            right: 0;
            width: 280px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.2s;
        }

        .model-listbox__dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .model-listbox__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .model-listbox__hint {
            font-size: 11px;
            font-weight: 400;
            color: var(--text-tertiary);
        }

        .model-listbox__options {
            padding: 8px;
            max-height: 240px;
            overflow-y: auto;
        }

        .model-listbox__option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 4px;
        }

        .model-listbox__option:last-child {
            margin-bottom: 0;
        }

        .model-listbox__option:hover {
            background: var(--surface);
        }

        .model-listbox__option--selected {
            background: var(--primary-50);
        }

        .model-listbox__option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .model-listbox__checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .model-listbox__option input[type="checkbox"]:checked+.model-listbox__checkbox {
            background: var(--primary-600);
            border-color: var(--primary-600);
        }

        .model-listbox__option input[type="checkbox"]:checked+.model-listbox__checkbox::after {
            content: '';
            width: 5px;
            height: 9px;
            border: 2px solid white;
            border-top: none;
            border-left: none;
            transform: rotate(45deg) translateY(-1px);
        }

        .model-listbox__dot {
            width: 10px;
            height: 10px;
            border-radius: var(--radius-full);
            flex-shrink: 0;
        }

        .model-listbox__dot--gpt {
            background: var(--gpt-color);
        }

        .model-listbox__dot--claude {
            background: var(--claude-color);
        }

        .model-listbox__dot--gemini {
            background: var(--gemini-color);
        }

        .model-listbox__dot--exaone {
            background: var(--exaone-color);
        }

        .model-listbox__info {
            flex: 1;
        }

        .model-listbox__name {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .model-listbox__provider {
            display: block;
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 1px;
        }

        /* ========== Dropdowns & Modals ========== */
        .dropdown {
            position: absolute;
            min-width: 200px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s;
        }

        .dropdown--open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown__item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
            transition: background 0.2s;
        }

        .dropdown__item:first-child {
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .dropdown__item:last-child {
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        .dropdown__item:hover {
            background: var(--surface);
        }

        .dropdown__item--active {
            background: var(--primary-50);
            color: var(--primary-600);
        }

        .dropdown__item--danger {
            color: var(--error);
        }

        .dropdown__item--danger:hover {
            background: #fef2f2;
        }

        .dropdown__divider {
            height: 1px;
            background: var(--border);
            margin: 4px 0;
        }

        .dropdown__icon {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }

        .plus-menu {
            position: fixed;
            width: 300px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            padding: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.2s;
        }

        .plus-menu--open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .plus-menu__section {
            padding: 4px 8px;
        }

        .plus-menu__section-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 4px 4px;
        }

        .plus-menu__item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background 0.2s;
        }

        .plus-menu__item:hover {
            background: var(--surface);
        }

        .plus-menu__item--highlight {
            background: linear-gradient(135deg, var(--primary-50), var(--primary-100));
        }

        .plus-menu__item--highlight:hover {
            background: linear-gradient(135deg, var(--primary-100), var(--primary-200));
        }

        .plus-menu__icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: var(--primary-50);
            color: var(--primary-600);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .plus-menu__icon--tuning {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
            color: white;
        }

        .plus-menu__text {
            flex: 1;
        }

        .plus-menu__title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .plus-menu__badge {
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            background: var(--primary-600);
            color: white;
        }

        .plus-menu__desc {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .plus-menu__divider {
            height: 1px;
            background: var(--border);
            margin: 8px 0;
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            min-width: 160px;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            padding: 4px;
            opacity: 0;
            visibility: hidden;
        }

        .context-menu--open {
            opacity: 1;
            visibility: visible;
        }

        .context-menu__item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: background 0.2s;
        }

        .context-menu__item:hover {
            background: var(--surface);
        }

        .context-menu__item--danger {
            color: var(--error);
        }

        .context-menu__item--danger:hover {
            background: #fef2f2;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .modal-overlay--open {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--background);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 520px;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.2s;
        }

        .modal-overlay--open .modal {
            transform: scale(1);
        }

        .modal__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal__title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal__close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal__close:hover {
            background: var(--gray-100);
            color: var(--text-primary);
        }

        .modal__body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal__footer {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            background: var(--gray-50);
        }

        .modal__btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--background);
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal__btn:hover {
            background: var(--gray-100);
        }

        .modal__btn--primary {
            background: var(--primary-600);
            border-color: var(--primary-600);
            color: white;
        }

        .modal__btn--primary:hover {
            background: var(--primary-700);
        }

        .modal__btn--danger {
            background: var(--error);
            border-color: var(--error);
            color: white;
        }

        .modal__btn--danger:hover {
            background: #dc2626;
        }

        /* Tuning Settings Styles */
        .tuning-section {
            margin-bottom: 20px;
        }

        .tuning-section:last-child {
            margin-bottom: 0;
        }

        .tuning-section__title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tuning-section__title-icon {
            width: 18px;
            height: 18px;
            color: var(--primary-600);
        }

        .tuning-slider {
            margin-bottom: 16px;
        }

        .tuning-slider__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .tuning-slider__label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .tuning-slider__value {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-600);
            background: var(--primary-50);
            padding: 2px 8px;
            border-radius: var(--radius-sm);
        }

        .tuning-slider__input {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            outline: none;
        }

        .tuning-slider__input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-600);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .tuning-slider__input::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .tuning-slider__desc {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 6px;
        }

        .tuning-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .tuning-preset {
            padding: 10px 8px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tuning-preset:hover {
            border-color: var(--primary-300);
            background: var(--primary-50);
        }

        .tuning-preset--active {
            border-color: var(--primary-500);
            background: var(--primary-50);
        }

        .tuning-preset__name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .tuning-preset__value {
            font-size: 10px;
            color: var(--text-tertiary);
        }

        .tuning-fewshot {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 12px;
        }

        .tuning-fewshot__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .tuning-fewshot__title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .tuning-fewshot__add {
            font-size: 12px;
            color: var(--primary-600);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tuning-fewshot__add:hover {
            text-decoration: underline;
        }

        .tuning-fewshot__item {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 10px;
            margin-bottom: 8px;
        }

        .tuning-fewshot__item:last-child {
            margin-bottom: 0;
        }

        .tuning-fewshot__label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .tuning-fewshot__input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-family: var(--font-sans);
            resize: none;
        }

        .tuning-fewshot__input:focus {
            outline: none;
            border-color: var(--primary-400);
        }

        .tuning-fewshot__remove {
            font-size: 11px;
            color: var(--error);
            cursor: pointer;
            margin-top: 8px;
            text-align: right;
        }

        /* Settings Panel */
        .settings-dropdown {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 0;
            width: 280px;
            z-index: 9999;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
        }

        .settings-dropdown__item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
        }

        .settings-dropdown__label {
            font-size: 13px;
            color: var(--text-primary);
        }

        .settings-dropdown__toggle {
            width: 40px;
            height: 22px;
            background: var(--gray-300);
            border-radius: var(--radius-full);
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }

        .settings-dropdown__toggle--active {
            background: var(--primary-600);
        }

        .settings-dropdown__toggle::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: var(--radius-full);
            top: 2px;
            left: 2px;
            transition: transform 0.2s;
            box-shadow: var(--shadow-sm);
        }

        .settings-dropdown__toggle--active::after {
            transform: translateX(18px);
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: var(--text-tertiary);
        }

        .empty-state__icon {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
            color: var(--gray-400);
        }

        .empty-state__title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .empty-state__desc {
            font-size: 14px;
            max-width: 300px;
            line-height: 1.5;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .typing-indicator__dot {
            width: 8px;
            height: 8px;
            background: var(--gray-300);
            border-radius: var(--radius-full);
            animation: typing 1.4s infinite;
        }

        .typing-indicator__dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator__dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
                opacity: 0.4;
            }

            30% {
                transform: translateY(-4px);
                opacity: 1;
            }
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--gray-800);
            color: white;
            border-radius: var(--radius-md);
            font-size: 14px;
            box-shadow: var(--shadow-lg);
            z-index: 99999;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast--success {
            background: var(--success);
        }

        .toast--warning {
            background: var(--warning);
        }

        .toast--error {
            background: var(--error);
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar__header">
                <div class="sidebar__logo">
                    <div class="sidebar__logo-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5z" />
                            <path d="M2 17l10 5 10-5M2 12l10 5 10-5" />
                        </svg>
                    </div>
                    <span class="sidebar__logo-text">GrowFit</span>
                    <span class="sidebar__logo-badge">AI</span>
                </div>

                <div class="class-selector">
                    <button class="class-selector__button" id="classButton" onclick="toggleClassDropdown()">
                        <div class="class-selector__icon">
                            <svg class="icon icon--sm" viewBox="0 0 24 24">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                            </svg>
                        </div>
                        <div class="class-selector__info">
                            <div class="class-selector__name" id="selectedClassName">AI 기초 실습</div>
                            <div class="class-selector__meta">
                                <span class="class-selector__status class-selector__status--active">
                                    <span class="class-selector__status-dot"></span>진행 중
                                </span>
                                <span class="class-selector__dday" id="selectedClassDday">D-15</span>
                            </div>
                        </div>
                        <svg class="icon icon--sm class-selector__arrow" viewBox="0 0 24 24">
                            <path d="M6 9l6 6 6-6" />
                        </svg>
                    </button>

                    <div class="class-dropdown" id="classDropdown">
                        <div class="class-dropdown__section">
                            <div class="class-dropdown__section-title">진행 중인 클래스</div>
                            <div class="class-dropdown__item class-dropdown__item--active" data-class-id="class-1"
                                onclick="selectClass('class-1', 'AI 기초 실습', 'active', 15)">
                                <div class="class-dropdown__item-icon class-dropdown__item-icon--active"><svg
                                        class="icon" viewBox="0 0 24 24">
                                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                                    </svg></div>
                                <div class="class-dropdown__item-info">
                                    <div class="class-dropdown__item-name">AI 기초 실습</div>
                                    <div class="class-dropdown__item-period">2025.11.01 ~ 2025.12.01</div>
                                </div>
                                <span class="class-dropdown__item-badge class-dropdown__item-badge--active">D-15</span>
                            </div>
                            <div class="class-dropdown__item" data-class-id="class-2"
                                onclick="selectClass('class-2', '프롬프트 엔지니어링', 'active', 30)">
                                <div class="class-dropdown__item-icon class-dropdown__item-icon--active"><svg
                                        class="icon" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10" />
                                        <path d="M12 16v-4" />
                                        <path d="M12 8h.01" />
                                    </svg></div>
                                <div class="class-dropdown__item-info">
                                    <div class="class-dropdown__item-name">프롬프트 엔지니어링</div>
                                    <div class="class-dropdown__item-period">2025.11.15 ~ 2025.12.15</div>
                                </div>
                                <span class="class-dropdown__item-badge class-dropdown__item-badge--active">D-30</span>
                            </div>
                        </div>
                        <div class="class-dropdown__divider"></div>
                        <div class="class-dropdown__section">
                            <div class="class-dropdown__section-title">종료된 클래스</div>
                            <div class="class-dropdown__item class-dropdown__item--disabled"
                                onclick="selectClass('class-ended', '2024 AI 기초과정', 'ended', 0)">
                                <div class="class-dropdown__item-icon class-dropdown__item-icon--ended"><svg
                                        class="icon" viewBox="0 0 24 24">
                                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                                    </svg></div>
                                <div class="class-dropdown__item-info">
                                    <div class="class-dropdown__item-name">2024 AI 기초과정</div>
                                    <div class="class-dropdown__item-period">2024.09.01 ~ 2024.10.31</div>
                                </div>
                                <span class="class-dropdown__item-badge class-dropdown__item-badge--ended">종료</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="sidebar__new-chat" onclick="createNewChat()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 5v14" />
                        <path d="M5 12h14" />
                    </svg>
                    <span>새 대화</span>
                </button>
            </div>

            <nav class="sidebar__nav">
                <a class="sidebar__nav-item" data-page="dashboard" onclick="navigateTo('dashboard')">
                    <span class="sidebar__nav-icon"><svg class="icon" viewBox="0 0 24 24">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                            <polyline points="9 22 9 12 15 12 15 22" />
                        </svg></span>
                    <span>대시보드</span>
                </a>
                <a class="sidebar__nav-item sidebar__nav-item--active" data-page="chat" onclick="navigateTo('chat')">
                    <span class="sidebar__nav-icon"><svg class="icon" viewBox="0 0 24 24">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                        </svg></span>
                    <span>AI 실습</span>
                </a>
                <a class="sidebar__nav-item" data-page="projects" onclick="navigateTo('projects')">
                    <span class="sidebar__nav-icon"><svg class="icon" viewBox="0 0 24 24">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                        </svg></span>
                    <span>내 프로젝트</span>
                </a>
                <a class="sidebar__nav-item" data-page="knowledge" onclick="navigateTo('knowledge')">
                    <span class="sidebar__nav-icon"><svg class="icon" viewBox="0 0 24 24">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                        </svg></span>
                    <span>지식베이스</span>
                </a>
                <a class="sidebar__nav-item" data-page="agents" onclick="navigateTo('agents')">
                    <span class="sidebar__nav-icon"><svg class="icon" viewBox="0 0 24 24">
                            <rect x="3" y="11" width="18" height="10" rx="2" />
                            <circle cx="12" cy="5" r="3" />
                            <path d="M12 8v3" />
                            <circle cx="8" cy="16" r="1" />
                            <circle cx="16" cy="16" r="1" />
                        </svg></span>
                    <span>내 에이전트</span>
                </a>
                <a class="sidebar__nav-item" data-page="workflow" onclick="navigateTo('workflow')">
                    <span class="sidebar__nav-icon"><svg class="icon" viewBox="0 0 24 24">
                            <polyline points="16 3 21 3 21 8" />
                            <line x1="4" y1="20" x2="21" y2="3" />
                            <polyline points="21 16 21 21 16 21" />
                            <line x1="15" y1="15" x2="21" y2="21" />
                            <line x1="4" y1="4" x2="9" y2="9" />
                        </svg></span>
                    <span>워크플로우</span>
                </a>
                <a class="sidebar__nav-item" data-page="history" onclick="navigateTo('history')">
                    <span class="sidebar__nav-icon"><svg class="icon" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                            <polyline points="14 2 14 8 20 8" />
                            <line x1="16" y1="13" x2="8" y2="13" />
                            <line x1="16" y1="17" x2="8" y2="17" />
                            <line x1="10" y1="9" x2="8" y2="9" />
                        </svg></span>
                    <span>내 기록</span>
                </a>
            </nav>

            <div class="sidebar__section-header">
                <span class="sidebar__section-title">최근 대화</span>
                <div class="sidebar__section-actions">
                    <button class="sidebar__section-btn" title="대화 검색" onclick="openSearchModal()">
                        <svg class="icon icon--sm" viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8" />
                            <line x1="21" y1="21" x2="16.65" y2="16.65" />
                        </svg>
                    </button>
                    <button class="sidebar__section-btn" title="새 프로젝트" onclick="handleCreateProject()">
                        <svg class="icon icon--sm" viewBox="0 0 24 24">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                            <line x1="12" y1="11" x2="12" y2="17" />
                            <line x1="9" y1="14" x2="15" y2="14" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="sidebar__history" id="chatHistory"></div>

            <div class="sidebar__footer">
                <div class="sidebar__footer-item" onclick="openSettingsModal()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                    <span>설정</span>
                </div>
                <div class="sidebar__user" onclick="openProfileModal()">
                    <div class="sidebar__user-avatar">홍</div>
                    <span class="sidebar__user-name">홍길동</span>
                    <svg class="icon icon--sm sidebar__user-logout" viewBox="0 0 24 24" onclick="handleLogout(event)">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <header class="chat-header">
                <div class="chat-header__left">
                    <span class="chat-header__title" id="chatTitle" contenteditable="false" onclick="editTitle()">새로운
                        대화</span>
                    <svg class="icon icon--sm chat-header__edit" viewBox="0 0 24 24" onclick="editTitle()">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                    </svg>
                </div>
                <div class="chat-header__right">
                    <!-- 자동 모드 표시 -->
                    <div class="mode-indicator mode-indicator--single" id="modeIndicator">
                        <span class="mode-indicator__dot"></span>
                        <span class="mode-indicator__text" id="modeText">단일 모드</span>
                    </div>
                    <div class="chat-header__participants" id="activeModelsDisplay" onclick="openParticipantsModal()">
                        <div class="participant-avatar participant-avatar--gemini" title="Gemini">G</div>
                    </div>
                    <button class="chat-header__btn" title="참여자 초대" onclick="openInviteModal()">
                        <svg class="icon icon--sm" viewBox="0 0 24 24">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="8.5" cy="7" r="4" />
                            <line x1="20" y1="8" x2="20" y2="14" />
                            <line x1="23" y1="11" x2="17" y2="11" />
                        </svg>
                    </button>
                    <button class="chat-header__btn" id="moreBtn" title="더보기" onclick="toggleMoreMenu()">
                        <svg class="icon icon--sm" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="1" />
                            <circle cx="19" cy="12" r="1" />
                            <circle cx="5" cy="12" r="1" />
                        </svg>
                    </button>
                    <div class="dropdown" id="moreMenu" style="right: 0; top: auto;">
                        <div class="dropdown__item" onclick="shareChat()"><svg class="icon icon--sm"
                                viewBox="0 0 24 24">
                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                                <polyline points="16 6 12 2 8 6" />
                                <line x1="12" y1="2" x2="12" y2="15" />
                            </svg>공유하기</div>
                        <div class="dropdown__item" onclick="exportChat()"><svg class="icon icon--sm"
                                viewBox="0 0 24 24">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="7 10 12 15 17 10" />
                                <line x1="12" y1="15" x2="12" y2="3" />
                            </svg>내보내기</div>
                        <div class="dropdown__divider"></div>
                        <div class="dropdown__item dropdown__item--danger" onclick="clearChat()"><svg
                                class="icon icon--sm" viewBox="0 0 24 24">
                                <path d="M3 6h18" />
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                            </svg>대화 삭제</div>
                    </div>
                </div>
            </header>

            <div class="chat-content">
                <div class="chat-area" id="chatAreaSingle">
                    <div class="messages" id="messagesContainer"></div>
                </div>
                <div class="chat-area chat-area--compare" id="chatAreaCompare"></div>

                <div class="input-area">
                    <div class="input-container">
                        <div class="input-preview" id="inputPreview">
                            <svg class="icon icon--sm input-preview__icon" viewBox="0 0 24 24">
                                <path
                                    d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                            </svg>
                            <span class="input-preview__text" id="previewText"></span>
                            <button class="input-preview__close" onclick="closePreview()">
                                <svg class="icon icon--sm" viewBox="0 0 24 24">
                                    <line x1="18" y1="6" x2="6" y2="18" />
                                    <line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                        <div class="input-box">
                            <textarea class="input-box__textarea" id="chatInput" placeholder="메시지를 입력하세요..." rows="1"
                                onkeydown="handleKeyDown(event)" oninput="autoResize(this)"></textarea>
                            <div class="input-box__footer">
                                <div class="input-box__left">
                                    <button class="input-btn" id="plusBtn" onclick="togglePlusMenu()">
                                        <svg class="icon" viewBox="0 0 24 24">
                                            <line x1="12" y1="5" x2="12" y2="19" />
                                            <line x1="5" y1="12" x2="19" y2="12" />
                                        </svg>
                                    </button>
                                    <div style="position: relative;">
                                        <button class="input-btn" id="inputSettingsBtn" onclick="toggleInputSettings()"
                                            title="빠른 설정">
                                            <svg class="icon" viewBox="0 0 24 24">
                                                <line x1="4" y1="21" x2="4" y2="14" />
                                                <line x1="4" y1="10" x2="4" y2="3" />
                                                <line x1="12" y1="21" x2="12" y2="12" />
                                                <line x1="12" y1="8" x2="12" y2="3" />
                                                <line x1="20" y1="21" x2="20" y2="16" />
                                                <line x1="20" y1="12" x2="20" y2="3" />
                                                <line x1="1" y1="14" x2="7" y2="14" />
                                                <line x1="9" y1="8" x2="15" y2="8" />
                                                <line x1="17" y1="16" x2="23" y2="16" />
                                            </svg>
                                            <span class="input-btn__badge" id="settingsBadge">3</span>
                                        </button>
                                        <div class="dropdown settings-dropdown" id="inputSettingsDropdown">
                                            <div class="settings-dropdown__item">
                                                <span class="settings-dropdown__label">스트리밍 응답</span>
                                                <div class="settings-dropdown__toggle settings-dropdown__toggle--active"
                                                    onclick="toggleSetting(this, 'streaming')"></div>
                                            </div>
                                            <div class="settings-dropdown__item">
                                                <span class="settings-dropdown__label">자동 저장</span>
                                                <div class="settings-dropdown__toggle settings-dropdown__toggle--active"
                                                    onclick="toggleSetting(this, 'autosave')"></div>
                                            </div>
                                            <div class="settings-dropdown__item">
                                                <span class="settings-dropdown__label">맞춤법 검사</span>
                                                <div class="settings-dropdown__toggle settings-dropdown__toggle--active"
                                                    onclick="toggleSetting(this, 'spellcheck')"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-box__right">
                                    <!-- 모델 리스트박스 선택 -->
                                    <div class="model-listbox" id="modelListbox">
                                        <button class="model-listbox__trigger" id="modelListboxTrigger"
                                            onclick="toggleModelListbox()">
                                            <span class="model-listbox__label">LLM 모델</span>
                                            <span class="model-listbox__selected" id="modelSelectedText">Gemini</span>
                                            <span class="model-listbox__count" id="modelSelectedCount">1개 선택</span>
                                            <svg class="icon icon--sm model-listbox__arrow" viewBox="0 0 24 24">
                                                <path d="M6 9l6 6 6-6" />
                                            </svg>
                                        </button>
                                        <div class="model-listbox__dropdown" id="modelListboxDropdown">
                                            <div class="model-listbox__header">
                                                <span>모델 선택</span>
                                                <span class="model-listbox__hint">최대 3개 선택 가능</span>
                                            </div>
                                            <div class="model-listbox__options">
                                                <label class="model-listbox__option model-listbox__option--selected"
                                                    data-model="gemini">
                                                    <input type="checkbox" checked
                                                        onchange="handleModelCheckbox(this, 'gemini')">
                                                    <span class="model-listbox__checkbox"></span>
                                                    <span class="model-listbox__dot model-listbox__dot--gemini"></span>
                                                    <span class="model-listbox__info">
                                                        <span class="model-listbox__name">Gemini 1.5 Flash</span>
                                                        <span class="model-listbox__provider">Google</span>
                                                    </span>
                                                </label>
                                                <label class="model-listbox__option" data-model="gpt">
                                                    <input type="checkbox" onchange="handleModelCheckbox(this, 'gpt')">
                                                    <span class="model-listbox__checkbox"></span>
                                                    <span class="model-listbox__dot model-listbox__dot--gpt"></span>
                                                    <span class="model-listbox__info">
                                                        <span class="model-listbox__name">GPT-4 Turbo</span>
                                                        <span class="model-listbox__provider">OpenAI</span>
                                                    </span>
                                                </label>
                                                <label class="model-listbox__option" data-model="claude">
                                                    <input type="checkbox"
                                                        onchange="handleModelCheckbox(this, 'claude')">
                                                    <span class="model-listbox__checkbox"></span>
                                                    <span class="model-listbox__dot model-listbox__dot--claude"></span>
                                                    <span class="model-listbox__info">
                                                        <span class="model-listbox__name">Claude 3.5 Sonnet</span>
                                                        <span class="model-listbox__provider">Anthropic</span>
                                                    </span>
                                                </label>
                                                <label class="model-listbox__option" data-model="exaone">
                                                    <input type="checkbox"
                                                        onchange="handleModelCheckbox(this, 'exaone')">
                                                    <span class="model-listbox__checkbox"></span>
                                                    <span class="model-listbox__dot model-listbox__dot--exaone"></span>
                                                    <span class="model-listbox__info">
                                                        <span class="model-listbox__name">EXAONE 3.5</span>
                                                        <span class="model-listbox__provider">LG AI Research</span>
                                                    </span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="input-btn" id="micBtn" title="음성 입력" onclick="toggleVoiceInput()">
                                        <svg class="icon" viewBox="0 0 24 24">
                                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                            <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                            <line x1="12" y1="19" x2="12" y2="23" />
                                            <line x1="8" y1="23" x2="16" y2="23" />
                                        </svg>
                                    </button>
                                    <button class="input-btn input-btn--primary" id="sendBtn" onclick="sendMessage()"
                                        title="전송">
                                        <svg class="icon" viewBox="0 0 24 24" style="color: white;">
                                            <line x1="22" y1="2" x2="11" y2="13" />
                                            <polygon points="22 2 15 22 11 13 2 9 22 2" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Plus Menu (Updated with Tuning & Project) -->
    <div class="plus-menu" id="plusMenu">
        <div class="plus-menu__section">
            <div class="plus-menu__section-title">파일 & 문서</div>
            <div class="plus-menu__item" onclick="handleUploadFile()">
                <div class="plus-menu__icon"><svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                    </svg></div>
                <div class="plus-menu__text">
                    <div class="plus-menu__title">파일 첨부</div>
                    <div class="plus-menu__desc">이미지, 문서 등을 업로드</div>
                </div>
            </div>
            <div class="plus-menu__item" onclick="handleUseTemplate()">
                <div class="plus-menu__icon"><svg class="icon" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                        <line x1="3" y1="9" x2="21" y2="9" />
                        <line x1="9" y1="21" x2="9" y2="9" />
                    </svg></div>
                <div class="plus-menu__text">
                    <div class="plus-menu__title">템플릿 사용</div>
                    <div class="plus-menu__desc">저장된 프롬프트 템플릿</div>
                </div>
            </div>
            <div class="plus-menu__item" onclick="handleUseKnowledge()">
                <div class="plus-menu__icon"><svg class="icon" viewBox="0 0 24 24">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                    </svg></div>
                <div class="plus-menu__text">
                    <div class="plus-menu__title">지식베이스 연결</div>
                    <div class="plus-menu__desc">RAG 문서 참조</div>
                </div>
            </div>
        </div>
        <div class="plus-menu__divider"></div>
        <div class="plus-menu__section">
            <div class="plus-menu__section-title">프로젝트</div>
            <div class="plus-menu__item" onclick="handleCreateProject()">
                <div class="plus-menu__icon"
                    style="background: var(--success); background: linear-gradient(135deg, #10b981, #059669); color: white;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                        <line x1="12" y1="11" x2="12" y2="17" />
                        <line x1="9" y1="14" x2="15" y2="14" />
                    </svg></div>
                <div class="plus-menu__text">
                    <div class="plus-menu__title">새 프로젝트 생성</div>
                    <div class="plus-menu__desc">대화를 프로젝트로 구성</div>
                </div>
            </div>
            <div class="plus-menu__item" onclick="handleOpenProjects()">
                <div class="plus-menu__icon"
                    style="background: var(--info); background: linear-gradient(135deg, #3b82f6, #2563eb); color: white;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                    </svg></div>
                <div class="plus-menu__text">
                    <div class="plus-menu__title">프로젝트 목록</div>
                    <div class="plus-menu__desc">저장된 프로젝트 열기</div>
                </div>
            </div>
            <div class="plus-menu__item" onclick="handleSaveToProject()">
                <div class="plus-menu__icon"><svg class="icon" viewBox="0 0 24 24">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                        <polyline points="17 21 17 13 7 13 7 21" />
                        <polyline points="7 3 7 8 15 8" />
                    </svg></div>
                <div class="plus-menu__text">
                    <div class="plus-menu__title">프로젝트에 저장</div>
                    <div class="plus-menu__desc">현재 대화를 프로젝트에 추가</div>
                </div>
            </div>
        </div>
        <div class="plus-menu__divider"></div>
        <div class="plus-menu__section">
            <div class="plus-menu__section-title">고급 설정</div>
            <div class="plus-menu__item plus-menu__item--highlight" onclick="openTuningModal()">
                <div class="plus-menu__icon plus-menu__icon--tuning">
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                </div>
                <div class="plus-menu__text">
                    <div class="plus-menu__title">상세 설정 <span class="plus-menu__badge">NEW</span></div>
                    <div class="plus-menu__desc">Temperature, Few-shot 등 파인튜닝</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu for Chat Items -->
    <div class="context-menu" id="chatContextMenu">
        <div class="context-menu__item" onclick="renameChat()"><svg class="icon icon--sm" viewBox="0 0 24 24">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
            </svg>이름 변경</div>
        <div class="context-menu__item" onclick="duplicateChat()"><svg class="icon icon--sm" viewBox="0 0 24 24">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
            </svg>복제</div>
        <div class="context-menu__item context-menu__item--danger" onclick="deleteChat()"><svg class="icon icon--sm"
                viewBox="0 0 24 24">
                <path d="M3 6h18" />
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
            </svg>삭제</div>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal__header">
                <h3 class="modal__title" id="modalTitle">모달 제목</h3>
                <button class="modal__close" onclick="closeModal()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal__body" id="modalBody"></div>
            <div class="modal__footer" id="modalFooter"></div>
        </div>
    </div>

    <script>
        // ========== App State ==========
        const AppState = {
            selectedClass: { id: 'class-1', name: 'AI 기초 실습', status: 'active', dday: 15 },
            selectedModels: ['gemini'], // 선택된 모델 배열
            mode: 'single', // 'single' or 'compare' - 자동 전환
            currentChatId: null,
            isRecording: false,
            settings: { streaming: true, autosave: true, spellcheck: true },
            tuningSettings: {
                temperature: 0.7,
                topP: 0.9,
                maxLength: 2048,
                preset: 'balanced',
                fewShotExamples: []
            }
        };

        // ========== Initialize ==========
        document.addEventListener('DOMContentLoaded', () => {
            renderChatHistory();
            renderEmptyChat();
            updateModeDisplay();
        });

        function renderChatHistory() {
            const history = document.getElementById('chatHistory');
            const chats = [
                { id: 1, title: '프롬프트 엔지니어링 실습', time: '2분 전', active: true },
                { id: 2, title: 'GPT vs Claude 비교', time: '1시간 전', active: false },
                { id: 3, title: '마케팅 문구 생성', time: '어제', active: false },
                { id: 4, title: '코드 리뷰 요청', time: '2일 전', active: false }
            ];
            history.innerHTML = chats.map(chat => `
                <div class="chat-item ${chat.active ? 'chat-item--active' : ''}" onclick="loadChat(${chat.id})">
                    <div class="chat-item__icon"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
                    <div class="chat-item__info"><div class="chat-item__title">${chat.title}</div><div class="chat-item__time">${chat.time}</div></div>
                    <button class="chat-item__menu" onclick="event.stopPropagation(); showChatContextMenu(event, ${chat.id})"><svg class="icon icon--sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg></button>
                </div>
            `).join('');
        }

        function renderEmptyChat() {
            document.getElementById('messagesContainer').innerHTML = `
                <div class="empty-state">
                    <svg class="empty-state__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <h3 class="empty-state__title">새로운 대화 시작</h3>
                    <p class="empty-state__desc">AI 모델을 선택하고 메시지를 입력하세요.<br>여러 모델을 선택하면 비교 모드가 활성화됩니다.</p>
                </div>
            `;
        }

        // ========== Model Listbox Functions ==========
        function toggleModelListbox() {
            const trigger = document.getElementById('modelListboxTrigger');
            const dropdown = document.getElementById('modelListboxDropdown');
            const isOpen = trigger.classList.contains('open');

            if (isOpen) {
                trigger.classList.remove('open');
                dropdown.classList.remove('open');
                dropdown.style.position = '';
                dropdown.style.left = '';
                dropdown.style.bottom = '';
            } else {
                // position: fixed로 위치 계산
                const rect = trigger.getBoundingClientRect();
                dropdown.style.position = 'fixed';
                dropdown.style.right = (window.innerWidth - rect.right) + 'px';
                dropdown.style.bottom = (window.innerHeight - rect.top + 8) + 'px';
                dropdown.style.left = 'auto';
                dropdown.style.top = 'auto';
                trigger.classList.add('open');
                dropdown.classList.add('open');
            }
        }

        function handleModelCheckbox(checkbox, model) {
            const option = checkbox.closest('.model-listbox__option');

            if (checkbox.checked) {
                // 최대 3개까지 선택 가능
                if (AppState.selectedModels.length >= 3) {
                    checkbox.checked = false;
                    showToast('최대 3개 모델까지 선택 가능합니다', 'warning');
                    return;
                }
                option.classList.add('model-listbox__option--selected');
                AppState.selectedModels.push(model);
            } else {
                // 최소 1개는 선택되어 있어야 함
                if (AppState.selectedModels.length <= 1) {
                    checkbox.checked = true;
                    showToast('최소 1개 모델은 선택해야 합니다', 'warning');
                    return;
                }
                option.classList.remove('model-listbox__option--selected');
                AppState.selectedModels = AppState.selectedModels.filter(m => m !== model);
            }

            updateModelListboxDisplay();
            updateModeDisplay();
        }

        function updateModelListboxDisplay() {
            const selectedText = document.getElementById('modelSelectedText');
            const countText = document.getElementById('modelSelectedCount');
            const modelNames = {
                gemini: 'Gemini',
                gpt: 'GPT-4',
                claude: 'Claude',
                exaone: 'EXAONE'
            };

            const names = AppState.selectedModels.map(m => modelNames[m]).join(', ');
            selectedText.textContent = names || '선택 없음';
            countText.textContent = `${AppState.selectedModels.length}개 선택`;
        }

        // ========== Project Functions ==========
        function handleCreateProject() {
            closePlusMenu();
            openModal('새 프로젝트 생성', `
                <div style="display: grid; gap: 16px;">
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 500; color: var(--text-primary); margin-bottom: 8px;">프로젝트 이름</label>
                        <input type="text" id="newProjectName" placeholder="프로젝트 이름을 입력하세요" style="width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 13px; font-weight: 500; color: var(--text-primary); margin-bottom: 8px;">설명 (선택)</label>
                        <textarea id="newProjectDesc" placeholder="프로젝트 설명을 입력하세요" rows="3" style="width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; resize: none;"></textarea>
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px;">
                        <button class="modal__btn" onclick="closeModal()">취소</button>
                        <button class="modal__btn modal__btn--primary" onclick="createProject()">생성하기</button>
                    </div>
                </div>
            `, false);
        }

        function createProject() {
            const name = document.getElementById('newProjectName').value.trim();
            if (!name) {
                showToast('프로젝트 이름을 입력하세요', 'warning');
                return;
            }
            closeModal();
            showToast(`'${name}' 프로젝트가 생성되었습니다`, 'success');
        }

        function handleOpenProjects() {
            closePlusMenu();
            openModal('프로젝트 목록', `
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--surface); border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--gray-200)'" onmouseout="this.style.background='var(--surface)'" onclick="loadProject('AI 기초 실습 프로젝트')">
                        <div style="width: 40px; height: 40px; background: var(--primary-100); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--primary-600);"><svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg></div>
                        <div style="flex: 1;"><div style="font-weight: 500;">AI 기초 실습 프로젝트</div><div style="font-size: 12px; color: var(--text-tertiary);">대화 5개 • 최근 수정: 2시간 전</div></div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--surface); border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--gray-200)'" onmouseout="this.style.background='var(--surface)'" onclick="loadProject('프롬프트 엔지니어링')">
                        <div style="width: 40px; height: 40px; background: var(--gemini-bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--gemini-color);"><svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg></div>
                        <div style="flex: 1;"><div style="font-weight: 500;">프롬프트 엔지니어링</div><div style="font-size: 12px; color: var(--text-tertiary);">대화 8개 • 최근 수정: 1일 전</div></div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 14px; background: var(--surface); border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--gray-200)'" onmouseout="this.style.background='var(--surface)'" onclick="loadProject('마케팅 문구 생성')">
                        <div style="width: 40px; height: 40px; background: var(--claude-bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--claude-color);"><svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg></div>
                        <div style="flex: 1;"><div style="font-weight: 500;">마케팅 문구 생성</div><div style="font-size: 12px; color: var(--text-tertiary);">대화 3개 • 최근 수정: 3일 전</div></div>
                    </div>
                </div>
            `);
        }

        function loadProject(name) {
            closeModal();
            showToast(`'${name}' 프로젝트를 불러왔습니다`, 'success');
        }

        function handleSaveToProject() {
            closePlusMenu();
            openModal('프로젝트에 저장', `
                <p style="color: var(--text-secondary); margin-bottom: 16px;">현재 대화를 저장할 프로젝트를 선택하세요:</p>
                <div style="display: grid; gap: 8px; margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--surface); border-radius: 8px; cursor: pointer;">
                        <input type="radio" name="projectSelect" value="project1" style="width: 16px; height: 16px;">
                        <span>AI 기초 실습 프로젝트</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--surface); border-radius: 8px; cursor: pointer;">
                        <input type="radio" name="projectSelect" value="project2" style="width: 16px; height: 16px;">
                        <span>프롬프트 엔지니어링</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--surface); border-radius: 8px; cursor: pointer;">
                        <input type="radio" name="projectSelect" value="project3" style="width: 16px; height: 16px;">
                        <span>마케팅 문구 생성</span>
                    </label>
                </div>
                <button class="modal__btn modal__btn--primary" style="width: 100%;" onclick="saveToSelectedProject()">저장하기</button>
            `, false);
        }

        function saveToSelectedProject() {
            const selected = document.querySelector('input[name="projectSelect"]:checked');
            if (!selected) {
                showToast('프로젝트를 선택해주세요', 'warning');
                return;
            }
            closeModal();
            showToast('프로젝트에 저장되었습니다', 'success');
        }

        function closePlusMenu() {
            document.getElementById('plusMenu')?.classList.remove('plus-menu--open');
        }

        // ========== Search Modal ==========
        function openSearchModal() {
            openModal('대화 검색', `
                <div style="margin-bottom: 16px;">
                    <div style="position: relative;">
                        <svg class="icon icon--sm" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                        <input type="text" id="searchInput" placeholder="대화 내용 검색..." style="width: 100%; padding: 10px 12px 10px 40px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;" oninput="filterSearchResults(this.value)">
                    </div>
                </div>
                <div id="searchResults" style="max-height: 300px; overflow-y: auto;">
                    <p style="color: var(--text-tertiary); font-size: 13px; text-align: center; padding: 20px;">검색어를 입력하세요</p>
                </div>
            `, false);
            setTimeout(() => document.getElementById('searchInput')?.focus(), 100);
        }

        function filterSearchResults(query) {
            const results = document.getElementById('searchResults');
            if (!query.trim()) {
                results.innerHTML = '<p style="color: var(--text-tertiary); font-size: 13px; text-align: center; padding: 20px;">검색어를 입력하세요</p>';
                return;
            }
            results.innerHTML = `
                <div style="display: grid; gap: 8px;">
                    <div style="padding: 12px; background: var(--surface); border-radius: 8px; cursor: pointer;" onclick="loadChat(1); closeModal();">
                        <div style="font-weight: 500; margin-bottom: 4px;">프롬프트 엔지니어링 실습</div>
                        <div style="font-size: 12px; color: var(--text-tertiary);">...${query}에 대한 내용이 포함되어 있습니다...</div>
                    </div>
                    <div style="padding: 12px; background: var(--surface); border-radius: 8px; cursor: pointer;" onclick="loadChat(2); closeModal();">
                        <div style="font-weight: 500; margin-bottom: 4px;">GPT vs Claude 비교</div>
                        <div style="font-size: 12px; color: var(--text-tertiary);">...${query} 관련 비교 분석...</div>
                    </div>
                </div>
            `;
        }

        // ========== Model Selection (Multi-Select) ==========
        function toggleModelSelection(element) {
            const model = element.dataset.model;
            const isSelected = element.classList.contains('model-chip--selected');

            if (isSelected) {
                // 최소 1개는 선택되어 있어야 함
                if (AppState.selectedModels.length <= 1) {
                    showToast('최소 1개 모델은 선택해야 합니다', 'warning');
                    return;
                }
                // 선택 해제
                element.classList.remove('model-chip--selected');
                AppState.selectedModels = AppState.selectedModels.filter(m => m !== model);
            } else {
                // 최대 4개까지 선택 가능
                if (AppState.selectedModels.length >= 4) {
                    showToast('최대 4개 모델까지 선택 가능합니다', 'warning');
                    return;
                }
                // 선택
                element.classList.add('model-chip--selected');
                AppState.selectedModels.push(model);
            }

            // 모드 자동 전환
            updateModeDisplay();
        }

        function updateModeDisplay() {
            const count = AppState.selectedModels.length;
            const indicator = document.getElementById('modeIndicator');
            const modeText = document.getElementById('modeText');
            const singleArea = document.getElementById('chatAreaSingle');
            const compareArea = document.getElementById('chatAreaCompare');

            if (count === 1) {
                // 단일 모드
                AppState.mode = 'single';
                indicator.className = 'mode-indicator mode-indicator--single';
                modeText.textContent = '단일 모드';
                singleArea.style.display = 'block';
                compareArea.style.display = 'none';
            } else {
                // 비교 모드 - 화면 분할
                AppState.mode = 'compare';
                indicator.className = 'mode-indicator mode-indicator--compare';
                modeText.textContent = `비교 모드 (${count}개)`;
                singleArea.style.display = 'none';
                compareArea.style.display = 'grid';
                renderComparePanels();
            }

            // 헤더의 참여 모델 표시 업데이트
            updateParticipantsDisplay();
        }

        function updateParticipantsDisplay() {
            const display = document.getElementById('activeModelsDisplay');
            const modelInfo = {
                gemini: { letter: 'G', class: 'gemini' },
                gpt: { letter: 'G', class: 'gpt' },
                claude: { letter: 'C', class: 'claude' },
                exaone: { letter: 'E', class: 'exaone' }
            };

            display.innerHTML = AppState.selectedModels.map(model => {
                const info = modelInfo[model];
                return `<div class="participant-avatar participant-avatar--${info.class}" title="${model}">${info.letter}</div>`;
            }).join('');
        }

        function renderComparePanels() {
            const compareArea = document.getElementById('chatAreaCompare');
            const modelNames = {
                gemini: 'Gemini 1.5 Flash',
                gpt: 'GPT-4 Turbo',
                claude: 'Claude 3.5 Sonnet',
                exaone: 'EXAONE 3.5'
            };
            const modelLetters = {
                gemini: 'G', gpt: 'G', claude: 'C', exaone: 'E'
            };

            compareArea.innerHTML = AppState.selectedModels.map(model => `
                <div class="compare-panel" data-model="${model}">
                    <div class="compare-panel__header">
                        <div class="compare-panel__model compare-panel__model--${model}">${modelLetters[model]}</div>
                        <span class="compare-panel__name">${modelNames[model]}</span>
                    </div>
                    <div class="compare-panel__body" id="compareMessages-${model}">
                        <div class="compare-panel__messages">
                            <div class="empty-state" style="height: 100%;">
                                <p style="font-size: 13px; color: var(--text-tertiary);">메시지를 입력하면<br>${modelNames[model]}의 응답이 표시됩니다</p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ========== Class Selector ==========
        function toggleClassDropdown() {
            const btn = document.getElementById('classButton');
            const dropdown = document.getElementById('classDropdown');
            btn.classList.toggle('open');
            dropdown.classList.toggle('class-dropdown--open');
        }

        function selectClass(id, name, status, dday) {
            if (status === 'ended') {
                if (confirm('종료된 클래스입니다. 기록 보기 화면으로 이동하시겠습니까?')) {
                    showToast('종료된 클래스 기록을 불러옵니다');
                }
                toggleClassDropdown();
                return;
            }
            AppState.selectedClass = { id, name, status, dday };
            document.getElementById('selectedClassName').textContent = name;
            document.getElementById('selectedClassDday').textContent = `D-${dday}`;
            document.querySelectorAll('.class-dropdown__item').forEach(item => {
                item.classList.toggle('class-dropdown__item--active', item.dataset.classId === id);
            });
            toggleClassDropdown();
            showToast(`${name} 클래스가 선택되었습니다`, 'success');
        }

        // ========== Plus Menu ==========
        function togglePlusMenu() {
            const menu = document.getElementById('plusMenu');
            const btn = document.getElementById('plusBtn');
            const isOpen = menu.classList.contains('plus-menu--open');
            if (!isOpen) {
                const rect = btn.getBoundingClientRect();
                menu.style.left = rect.left + 'px';
                menu.style.bottom = (window.innerHeight - rect.top + 8) + 'px';
            }
            menu.classList.toggle('plus-menu--open');
        }

        function handleUploadFile() {
            togglePlusMenu();
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,.pdf,.doc,.docx,.txt,.xlsx,.pptx';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('inputPreview').classList.add('input-preview--visible');
                    document.getElementById('previewText').textContent = file.name;
                    showToast(`"${file.name}" 첨부됨`, 'success');
                }
            };
            input.click();
        }

        function handleUseTemplate() {
            togglePlusMenu();
            openModal('템플릿 선택', `
                <div style="display: grid; gap: 8px;">
                    <div class="dropdown__item" onclick="insertTemplate('마케팅 문구 생성')">마케팅 문구 생성</div>
                    <div class="dropdown__item" onclick="insertTemplate('코드 리뷰 요청')">코드 리뷰 요청</div>
                    <div class="dropdown__item" onclick="insertTemplate('번역 요청')">번역 요청</div>
                    <div class="dropdown__item" onclick="insertTemplate('요약 요청')">요약 요청</div>
                </div>
            `, false);
        }

        function insertTemplate(name) {
            const templates = {
                '마케팅 문구 생성': '다음 제품에 대한 마케팅 문구를 작성해주세요:\n\n제품명: \n타겟 고객: \n주요 특징: ',
                '코드 리뷰 요청': '다음 코드를 리뷰해주세요. 개선점과 버그가 있다면 알려주세요:\n\n```\n// 코드를 여기에 붙여넣으세요\n```',
                '번역 요청': '다음 텍스트를 한국어로 번역해주세요:\n\n',
                '요약 요청': '다음 내용을 핵심만 3줄로 요약해주세요:\n\n'
            };
            document.getElementById('chatInput').value = templates[name] || '';
            closeModal();
            showToast(`"${name}" 템플릿 적용됨`, 'success');
        }

        function handleUseKnowledge() {
            togglePlusMenu();
            openModal('지식베이스 연결', `
                <p style="color: var(--text-secondary); margin-bottom: 16px;">연결할 지식베이스를 선택하세요:</p>
                <div style="display: grid; gap: 8px;">
                    <div class="dropdown__item" onclick="connectKnowledge('회사 정책 문서')">📁 회사 정책 문서</div>
                    <div class="dropdown__item" onclick="connectKnowledge('제품 매뉴얼')">📁 제품 매뉴얼</div>
                    <div class="dropdown__item" onclick="connectKnowledge('FAQ 데이터')">📁 FAQ 데이터</div>
                </div>
            `, false);
        }

        function connectKnowledge(name) {
            closeModal();
            showToast(`"${name}" 지식베이스 연결됨`, 'success');
        }

        function closePreview() {
            document.getElementById('inputPreview').classList.remove('input-preview--visible');
        }

        // ========== Tuning Modal ==========
        function openTuningModal() {
            togglePlusMenu();
            const { temperature, topP, maxLength, preset } = AppState.tuningSettings;

            openModal(
                '<svg class="icon" style="width:20px;height:20px;margin-right:8px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>상세 설정',
                `
                <div class="tuning-section">
                    <div class="tuning-section__title">
                        <svg class="tuning-section__title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                        스타일 프리셋
                    </div>
                    <div class="tuning-presets">
                        <div class="tuning-preset ${preset === 'precise' ? 'tuning-preset--active' : ''}" onclick="selectPreset('precise', 0.3)">
                            <div class="tuning-preset__name">정확한</div>
                            <div class="tuning-preset__value">T: 0.3</div>
                        </div>
                        <div class="tuning-preset ${preset === 'balanced' ? 'tuning-preset--active' : ''}" onclick="selectPreset('balanced', 0.7)">
                            <div class="tuning-preset__name">균형잡힌</div>
                            <div class="tuning-preset__value">T: 0.7</div>
                        </div>
                        <div class="tuning-preset ${preset === 'creative' ? 'tuning-preset--active' : ''}" onclick="selectPreset('creative', 1.0)">
                            <div class="tuning-preset__name">창의적</div>
                            <div class="tuning-preset__value">T: 1.0</div>
                        </div>
                        <div class="tuning-preset ${preset === 'custom' ? 'tuning-preset--active' : ''}" onclick="selectPreset('custom', null)">
                            <div class="tuning-preset__name">사용자 정의</div>
                            <div class="tuning-preset__value">커스텀</div>
                        </div>
                    </div>
                </div>

                <div class="tuning-section">
                    <div class="tuning-section__title">
                        <svg class="tuning-section__title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/></svg>
                        파라미터 조정
                    </div>
                    
                    <div class="tuning-slider">
                        <div class="tuning-slider__header">
                            <span class="tuning-slider__label">Temperature</span>
                            <span class="tuning-slider__value" id="tempValue">${temperature}</span>
                        </div>
                        <input type="range" class="tuning-slider__input" id="tempSlider" min="0" max="2" step="0.1" value="${temperature}" oninput="updateSlider('temp', this.value)">
                        <div class="tuning-slider__desc">낮을수록 일관된 응답, 높을수록 창의적인 응답</div>
                    </div>

                    <div class="tuning-slider">
                        <div class="tuning-slider__header">
                            <span class="tuning-slider__label">Top P</span>
                            <span class="tuning-slider__value" id="topPValue">${topP}</span>
                        </div>
                        <input type="range" class="tuning-slider__input" id="topPSlider" min="0" max="1" step="0.05" value="${topP}" oninput="updateSlider('topP', this.value)">
                        <div class="tuning-slider__desc">확률 기반 토큰 선택 범위 (0.9 권장)</div>
                    </div>

                    <div class="tuning-slider">
                        <div class="tuning-slider__header">
                            <span class="tuning-slider__label">Max Length</span>
                            <span class="tuning-slider__value" id="maxLengthValue">${maxLength}</span>
                        </div>
                        <input type="range" class="tuning-slider__input" id="maxLengthSlider" min="256" max="4096" step="256" value="${maxLength}" oninput="updateSlider('maxLength', this.value)">
                        <div class="tuning-slider__desc">생성할 최대 토큰 수</div>
                    </div>
                </div>

                <div class="tuning-section">
                    <div class="tuning-section__title">
                        <svg class="tuning-section__title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        Few-shot 예시
                    </div>
                    <div class="tuning-fewshot">
                        <div class="tuning-fewshot__header">
                            <span class="tuning-fewshot__title">입출력 예시 (선택사항)</span>
                            <span class="tuning-fewshot__add" onclick="addFewShotExample()">+ 예시 추가</span>
                        </div>
                        <div id="fewShotContainer">
                            <div class="tuning-fewshot__item">
                                <div class="tuning-fewshot__label">입력 (Input)</div>
                                <textarea class="tuning-fewshot__input" rows="2" placeholder="예시 입력을 작성하세요..."></textarea>
                                <div class="tuning-fewshot__label" style="margin-top: 8px;">출력 (Output)</div>
                                <textarea class="tuning-fewshot__input" rows="2" placeholder="예시 출력을 작성하세요..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                `,
                true,
                [
                    { text: '기본값으로 초기화', action: 'resetTuning()', primary: false },
                    { text: '적용', action: 'applyTuning()', primary: true }
                ]
            );
        }

        function selectPreset(preset, temp) {
            AppState.tuningSettings.preset = preset;
            document.querySelectorAll('.tuning-preset').forEach(el => el.classList.remove('tuning-preset--active'));
            event.currentTarget.classList.add('tuning-preset--active');

            if (temp !== null) {
                AppState.tuningSettings.temperature = temp;
                document.getElementById('tempSlider').value = temp;
                document.getElementById('tempValue').textContent = temp;
            }
        }

        function updateSlider(type, value) {
            if (type === 'temp') {
                AppState.tuningSettings.temperature = parseFloat(value);
                document.getElementById('tempValue').textContent = value;
                // 커스텀으로 변경
                AppState.tuningSettings.preset = 'custom';
                document.querySelectorAll('.tuning-preset').forEach(el => el.classList.remove('tuning-preset--active'));
                document.querySelector('.tuning-preset:last-child').classList.add('tuning-preset--active');
            } else if (type === 'topP') {
                AppState.tuningSettings.topP = parseFloat(value);
                document.getElementById('topPValue').textContent = value;
            } else if (type === 'maxLength') {
                AppState.tuningSettings.maxLength = parseInt(value);
                document.getElementById('maxLengthValue').textContent = value;
            }
        }

        function addFewShotExample() {
            const container = document.getElementById('fewShotContainer');
            const newExample = document.createElement('div');
            newExample.className = 'tuning-fewshot__item';
            newExample.innerHTML = `
                <div class="tuning-fewshot__label">입력 (Input)</div>
                <textarea class="tuning-fewshot__input" rows="2" placeholder="예시 입력을 작성하세요..."></textarea>
                <div class="tuning-fewshot__label" style="margin-top: 8px;">출력 (Output)</div>
                <textarea class="tuning-fewshot__input" rows="2" placeholder="예시 출력을 작성하세요..."></textarea>
                <div class="tuning-fewshot__remove" onclick="this.parentElement.remove()">삭제</div>
            `;
            container.appendChild(newExample);
        }

        function resetTuning() {
            AppState.tuningSettings = {
                temperature: 0.7,
                topP: 0.9,
                maxLength: 2048,
                preset: 'balanced',
                fewShotExamples: []
            };
            closeModal();
            showToast('설정이 기본값으로 초기화되었습니다', 'success');
        }

        function applyTuning() {
            closeModal();
            showToast(`설정 적용됨: Temperature ${AppState.tuningSettings.temperature}`, 'success');
        }

        // ========== Settings ==========
        function toggleInputSettings() {
            const btn = document.getElementById('inputSettingsBtn');
            const dropdown = document.getElementById('inputSettingsDropdown');
            const isOpen = dropdown.classList.contains('dropdown--open');

            if (isOpen) {
                dropdown.classList.remove('dropdown--open');
                dropdown.style.position = '';
                dropdown.style.left = '';
                dropdown.style.bottom = '';
            } else {
                // position: fixed로 위치 계산
                const rect = btn.getBoundingClientRect();
                dropdown.style.position = 'fixed';
                dropdown.style.left = rect.left + 'px';
                dropdown.style.bottom = (window.innerHeight - rect.top + 8) + 'px';
                dropdown.style.top = 'auto';
                dropdown.style.right = 'auto';
                dropdown.classList.add('dropdown--open');
            }
        }

        function toggleSetting(element, setting) {
            element.classList.toggle('settings-dropdown__toggle--active');
            AppState.settings[setting] = element.classList.contains('settings-dropdown__toggle--active');
            updateSettingsBadge();
            showToast(`${getSettingName(setting)} ${AppState.settings[setting] ? '활성화' : '비활성화'}`);
        }

        function getSettingName(setting) {
            return { streaming: '스트리밍 응답', autosave: '자동 저장', spellcheck: '맞춤법 검사' }[setting] || setting;
        }

        function updateSettingsBadge() {
            const count = Object.values(AppState.settings).filter(Boolean).length;
            document.getElementById('settingsBadge').textContent = count;
        }

        // ========== More Menu ==========
        function toggleMoreMenu() {
            const menu = document.getElementById('moreMenu');
            const btn = document.getElementById('moreBtn');
            const rect = btn.getBoundingClientRect();
            menu.style.top = (rect.bottom + 8) + 'px';
            menu.style.right = (window.innerWidth - rect.right) + 'px';
            menu.classList.toggle('dropdown--open');
        }

        function shareChat() { closeAllDropdowns(); navigator.clipboard?.writeText(window.location.href); showToast('공유 링크가 복사되었습니다', 'success'); }
        function exportChat() { closeAllDropdowns(); showToast('대화 내보내기 (준비 중)'); }
        function clearChat() {
            closeAllDropdowns();
            if (confirm('대화 내용을 모두 삭제하시겠습니까?')) {
                renderEmptyChat();
                showToast('대화 내용이 삭제되었습니다', 'success');
            }
        }

        // ========== Voice Input ==========
        function toggleVoiceInput() {
            const btn = document.getElementById('micBtn');
            AppState.isRecording = !AppState.isRecording;
            btn.classList.toggle('input-btn--recording', AppState.isRecording);
            if (AppState.isRecording) {
                showToast('음성 인식 시작... 말씀해주세요', 'info');
                setTimeout(() => {
                    if (AppState.isRecording) {
                        AppState.isRecording = false;
                        btn.classList.remove('input-btn--recording');
                        document.getElementById('chatInput').value = '안녕하세요, 음성 인식 테스트입니다.';
                        showToast('음성 인식 완료!', 'success');
                    }
                }, 3000);
            } else {
                showToast('음성 인식 중지');
            }
        }

        // ========== Chat Functions ==========
        function createNewChat() { renderEmptyChat(); document.getElementById('chatTitle').textContent = '새로운 대화'; showToast('새 대화가 생성되었습니다'); }
        function loadChat(id) {
            document.querySelectorAll('.chat-item').forEach(item => item.classList.remove('chat-item--active'));
            event.currentTarget.classList.add('chat-item--active');
            AppState.currentChatId = id;
            showToast(`대화 #${id} 불러오기`);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            if (AppState.mode === 'single') {
                const container = document.getElementById('messagesContainer');
                container.querySelector('.empty-state')?.remove();

                const modelName = AppState.selectedModels[0];
                const modelInfo = { gemini: { letter: 'G', name: 'Gemini' }, gpt: { letter: 'G', name: 'GPT-4' }, claude: { letter: 'C', name: 'Claude' }, exaone: { letter: 'E', name: 'EXAONE' } };
                const info = modelInfo[modelName];

                container.innerHTML += `
                    <div class="message message--user">
                        <div class="message__avatar message__avatar--user">홍</div>
                        <div class="message__content"><div class="message__bubble message__bubble--user">${escapeHtml(message)}</div></div>
                    </div>
                `;

                setTimeout(() => {
                    container.innerHTML += `
                        <div class="message">
                            <div class="message__avatar message__avatar--${modelName}">${info.letter}</div>
                            <div class="message__content">
                                <div class="message__bubble message__bubble--ai">안녕하세요! ${info.name}입니다. "${message}"에 대해 답변드리겠습니다.<br><br>Temperature: ${AppState.tuningSettings.temperature}, Max Length: ${AppState.tuningSettings.maxLength}로 설정되어 응답합니다.</div>
                                <div class="message__actions">
                                    <button class="message__action" title="복사"><svg class="icon icon--sm" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button>
                                    <button class="message__action" title="좋아요"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg></button>
                                    <button class="message__action" title="싫어요"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/></svg></button>
                                    <button class="message__action" title="재생성"><svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg></button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.scrollTop = container.scrollHeight;
                }, 1000);
            } else {
                // 비교 모드: 각 분할 패널에 채팅 형식으로 표시
                const modelInfo = {
                    gemini: { letter: 'G', name: 'Gemini 1.5 Flash', provider: 'Google' },
                    gpt: { letter: 'G', name: 'GPT-4 Turbo', provider: 'OpenAI' },
                    claude: { letter: 'C', name: 'Claude 3.5 Sonnet', provider: 'Anthropic' },
                    exaone: { letter: 'E', name: 'EXAONE 3.5', provider: 'LG AI Research' }
                };

                // 각 패널에 사용자 메시지와 AI 응답 추가
                AppState.selectedModels.forEach((model, index) => {
                    const panelBody = document.getElementById(`compareMessages-${model}`);
                    if (!panelBody) return;

                    const info = modelInfo[model];

                    // empty-state 제거
                    panelBody.querySelector('.empty-state')?.remove();

                    // messages 컨테이너 확인/생성
                    let messagesDiv = panelBody.querySelector('.compare-panel__messages');
                    if (!messagesDiv) {
                        messagesDiv = document.createElement('div');
                        messagesDiv.className = 'compare-panel__messages';
                        panelBody.appendChild(messagesDiv);
                    }

                    // 사용자 메시지 추가
                    messagesDiv.innerHTML += `
                        <div class="message message--user message--compact">
                            <div class="message__avatar message__avatar--user message__avatar--sm">홍</div>
                            <div class="message__content">
                                <div class="message__bubble message__bubble--user">${escapeHtml(message)}</div>
                            </div>
                        </div>
                    `;

                    // AI 로딩 상태 추가
                    const responseId = `response-${model}-${Date.now()}`;
                    messagesDiv.innerHTML += `
                        <div class="message message--compact" id="${responseId}">
                            <div class="message__avatar message__avatar--${model} message__avatar--sm">${info.letter}</div>
                            <div class="message__content">
                                <div class="message__bubble message__bubble--ai">
                                    <div class="typing-indicator">
                                        <span class="typing-indicator__dot"></span>
                                        <span class="typing-indicator__dot"></span>
                                        <span class="typing-indicator__dot"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // 스크롤
                    panelBody.scrollTop = panelBody.scrollHeight;

                    // AI 응답 시뮬레이션
                    setTimeout(() => {
                        const responseEl = document.getElementById(responseId);
                        if (responseEl) {
                            const responseTime = (0.8 + index * 0.3).toFixed(1);
                            const tokens = Math.floor(150 + Math.random() * 100);

                            responseEl.querySelector('.message__content').innerHTML = `
                                <div class="message__bubble message__bubble--ai">
                                    안녕하세요! ${info.name}입니다.<br><br>
                                    "${message}"에 대해 분석해 드리겠습니다.<br><br>
                                    Temperature ${AppState.tuningSettings.temperature} 설정으로 응답을 생성했습니다.
                                </div>
                                <div class="message__meta">
                                    <span>⏱ ${responseTime}s</span>
                                    <span>📝 ${tokens} tokens</span>
                                </div>
                                <div class="message__actions">
                                    <button class="message__action" title="복사"><svg class="icon icon--sm" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button>
                                    <button class="message__action" title="좋아요"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg></button>
                                    <button class="message__action" title="싫어요"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/></svg></button>
                                    <button class="message__action" title="재생성"><svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg></button>
                                </div>
                            `;
                            panelBody.scrollTop = panelBody.scrollHeight;
                        }
                    }, 800 + (index * 500));
                });

                showToast(`${AppState.selectedModels.length}개 모델에 동시 전송`, 'success');
            }

            input.value = '';
            input.style.height = 'auto';
            closePreview();
        }

        function editTitle() {
            const title = document.getElementById('chatTitle');
            title.contentEditable = 'true';
            title.focus();
            document.execCommand('selectAll', false, null);
            title.onblur = () => { title.contentEditable = 'false'; showToast('제목이 변경되었습니다'); };
            title.onkeydown = (e) => { if (e.key === 'Enter') { e.preventDefault(); title.blur(); } };
        }

        // ========== Navigation ==========
        function navigateTo(page) {
            document.querySelectorAll('.sidebar__nav-item').forEach(item => {
                item.classList.toggle('sidebar__nav-item--active', item.dataset.page === page);
            });
            showToast(`${page} 페이지로 이동 (준비 중)`);
        }

        // ========== Context Menu ==========
        function showChatContextMenu(event, chatId) {
            const menu = document.getElementById('chatContextMenu');
            menu.style.left = event.clientX + 'px';
            menu.style.top = event.clientY + 'px';
            menu.classList.add('context-menu--open');
            menu.dataset.chatId = chatId;
        }

        function closeChatContextMenu() { document.getElementById('chatContextMenu').classList.remove('context-menu--open'); }
        function renameChat() { closeChatContextMenu(); showToast('이름 변경 (준비 중)'); }
        function duplicateChat() { closeChatContextMenu(); showToast('대화 복제됨', 'success'); }
        function deleteChat() { closeChatContextMenu(); if (confirm('이 대화를 삭제하시겠습니까?')) showToast('대화가 삭제되었습니다', 'success'); }

        // ========== Modal ==========
        function openModal(title, body, showFooter = true, footerButtons = []) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalBody').innerHTML = body;

            const footer = document.getElementById('modalFooter');
            if (showFooter && footerButtons.length > 0) {
                footer.style.display = 'flex';
                footer.innerHTML = footerButtons.map(btn =>
                    `<button class="modal__btn ${btn.primary ? 'modal__btn--primary' : ''}" onclick="${btn.action}">${btn.text}</button>`
                ).join('');
            } else if (showFooter) {
                footer.style.display = 'flex';
                footer.innerHTML = '<button class="modal__btn modal__btn--primary" onclick="closeModal()">확인</button>';
            } else {
                footer.style.display = 'none';
            }

            document.getElementById('modalOverlay').classList.add('modal-overlay--open');
        }

        function closeModal() { document.getElementById('modalOverlay').classList.remove('modal-overlay--open'); }

        function openSettingsModal() {
            openModal('설정', `
                <div style="display: grid; gap: 16px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--surface); border-radius: 8px;">
                        <div><div style="font-weight: 500;">다크 모드</div><div style="font-size: 12px; color: var(--text-tertiary);">어두운 테마 사용</div></div>
                        <div class="settings-dropdown__toggle" onclick="toggleSetting(this, 'darkmode')"></div>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--surface); border-radius: 8px;">
                        <div><div style="font-weight: 500;">알림</div><div style="font-size: 12px; color: var(--text-tertiary);">푸시 알림 받기</div></div>
                        <div class="settings-dropdown__toggle settings-dropdown__toggle--active" onclick="toggleSetting(this, 'notifications')"></div>
                    </div>
                </div>
            `);
        }

        function openFriendsModal() {
            openModal('친구 목록', `
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--surface); border-radius: 8px;">
                        <div style="width: 40px; height: 40px; background: var(--primary-100); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary-600); font-weight: 600;">김</div>
                        <div style="flex: 1;"><div style="font-weight: 500;">김철수</div><div style="font-size: 12px; color: var(--text-tertiary);">온라인</div></div>
                        <button class="modal__btn" onclick="showToast('메시지 보내기 (준비 중)')">메시지</button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--surface); border-radius: 8px;">
                        <div style="width: 40px; height: 40px; background: var(--gray-200); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); font-weight: 600;">이</div>
                        <div style="flex: 1;"><div style="font-weight: 500;">이영희</div><div style="font-size: 12px; color: var(--text-tertiary);">오프라인</div></div>
                        <button class="modal__btn" onclick="showToast('메시지 보내기 (준비 중)')">메시지</button>
                    </div>
                </div>
            `);
        }

        function openProfileModal() {
            openModal('내 프로필', `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="width: 80px; height: 80px; margin: 0 auto 12px; background: linear-gradient(135deg, var(--primary-400), var(--primary-600)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: 600;">홍</div>
                    <h3>홍길동</h3>
                    <p style="color: var(--text-secondary);">hong@example.com</p>
                </div>
                <div style="display: grid; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--surface); border-radius: 8px;"><span>가입일</span><span style="color: var(--text-secondary);">2024.01.15</span></div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--surface); border-radius: 8px;"><span>총 대화 수</span><span style="color: var(--text-secondary);">127회</span></div>
                    <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--surface); border-radius: 8px;"><span>이번 달 사용량</span><span style="color: var(--text-secondary);">15,420 토큰</span></div>
                </div>
            `);
        }

        function openParticipantsModal() {
            const modelInfo = {
                gemini: { name: 'Gemini 1.5 Flash', provider: 'Google', bg: 'var(--gemini-bg)', color: 'var(--gemini-color)' },
                gpt: { name: 'GPT-4 Turbo', provider: 'OpenAI', bg: 'var(--gpt-bg)', color: 'var(--gpt-color)' },
                claude: { name: 'Claude 3.5 Sonnet', provider: 'Anthropic', bg: 'var(--claude-bg)', color: 'var(--claude-color)' },
                exaone: { name: 'EXAONE 3.5', provider: 'LG AI Research', bg: 'var(--exaone-bg)', color: 'var(--exaone-color)' }
            };
            const letters = { gemini: 'G', gpt: 'G', claude: 'C', exaone: 'E' };

            openModal('선택된 모델', `
                <div style="display: grid; gap: 12px;">
                    ${AppState.selectedModels.map(model => {
                const info = modelInfo[model];
                return `
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: ${info.bg}; border-radius: 8px;">
                                <div style="width: 40px; height: 40px; background: ${info.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">${letters[model]}</div>
                                <div style="flex: 1;"><div style="font-weight: 500;">${info.name}</div><div style="font-size: 12px; color: var(--text-tertiary);">${info.provider}</div></div>
                            </div>
                        `;
            }).join('')}
                </div>
            `);
        }

        function openInviteModal() {
            openModal('참여자 초대', `
                <p style="color: var(--text-secondary); margin-bottom: 16px;">이메일 주소를 입력하여 초대하세요:</p>
                <input type="email" placeholder="email@example.com" style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px;">
                <button class="modal__btn modal__btn--primary" style="width: 100%;" onclick="showToast('초대 메일이 발송되었습니다', 'success'); closeModal();">초대하기</button>
            `, false);
        }

        function handleLogout(event) {
            event.stopPropagation();
            if (confirm('로그아웃 하시겠습니까?')) {
                showToast('로그아웃 되었습니다');
                setTimeout(() => window.location.href = '/login.html', 1000);
            }
        }

        // ========== Utilities ==========
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 160) + 'px';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type = 'info') {
            document.querySelector('.toast')?.remove();
            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            toast.innerHTML = `<svg class="icon icon--sm" viewBox="0 0 24 24"><path d="${type === 'success' ? 'M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4L12 14.01l-3-3' : type === 'error' ? 'M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01' : type === 'warning' ? 'M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01' : 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 6v6M12 16h.01'}"/></svg>${message}`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown--open, .plus-menu--open, .context-menu--open').forEach(el => {
                el.classList.remove('dropdown--open', 'plus-menu--open', 'context-menu--open');
                el.style.position = '';
                el.style.left = '';
                el.style.right = '';
                el.style.top = '';
                el.style.bottom = '';
            });
            document.getElementById('classButton')?.classList.remove('open');
            document.getElementById('classDropdown')?.classList.remove('class-dropdown--open');
            // 모델 리스트박스 닫기
            const modelTrigger = document.getElementById('modelListboxTrigger');
            const modelDropdown = document.getElementById('modelListboxDropdown');
            if (modelTrigger) modelTrigger.classList.remove('open');
            if (modelDropdown) {
                modelDropdown.classList.remove('open');
                modelDropdown.style.position = '';
                modelDropdown.style.left = '';
                modelDropdown.style.right = '';
                modelDropdown.style.top = '';
                modelDropdown.style.bottom = '';
            }
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.class-selector')) { document.getElementById('classButton')?.classList.remove('open'); document.getElementById('classDropdown')?.classList.remove('class-dropdown--open'); }
            if (!e.target.closest('#plusBtn') && !e.target.closest('#plusMenu')) document.getElementById('plusMenu')?.classList.remove('plus-menu--open');
            if (!e.target.closest('#inputSettingsBtn') && !e.target.closest('#inputSettingsDropdown')) {
                const dropdown = document.getElementById('inputSettingsDropdown');
                if (dropdown) {
                    dropdown.classList.remove('dropdown--open');
                    dropdown.style.position = '';
                    dropdown.style.left = '';
                    dropdown.style.bottom = '';
                }
            }
            if (!e.target.closest('#moreBtn') && !e.target.closest('#moreMenu')) document.getElementById('moreMenu')?.classList.remove('dropdown--open');
            if (!e.target.closest('.chat-item__menu') && !e.target.closest('#chatContextMenu')) closeChatContextMenu();
            if (!e.target.closest('.model-listbox')) {
                const modelTrigger = document.getElementById('modelListboxTrigger');
                const modelDropdown = document.getElementById('modelListboxDropdown');
                if (modelTrigger) modelTrigger.classList.remove('open');
                if (modelDropdown) {
                    modelDropdown.classList.remove('open');
                    modelDropdown.style.position = '';
                    modelDropdown.style.left = '';
                    modelDropdown.style.right = '';
                    modelDropdown.style.bottom = '';
                }
            }
        });

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeAllDropdowns(); closeModal(); } });

        console.log('GrowFit Practice Page v6 - Model Listbox & Project Features');
    </script>
</body>

</html>